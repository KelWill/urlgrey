!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.urlgrey=e():"undefined"!=typeof global?global.urlgrey=e():"undefined"!=typeof self&&(self.urlgrey=e())}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var QueryString=exports;var isString=require("../util").isString;var isArray=require("../util").isArray;var isBoolean=require("../util").isBoolean;var isNumber=require("../util").isNumber;var isObject=require("../util").isObject;var isNull=require("../util").isNull;var keys=require("../util").keys;var map=require("../util").map;function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}function charCode(c){return c.charCodeAt(0)}QueryString.unescape=function(s){return decodeURIComponent(s)};QueryString.escape=function(str){return encodeURIComponent(str)};var stringifyPrimitive=function(v){if(isString(v))return v;if(isBoolean(v))return v?"true":"false";if(isNumber(v))return isFinite(v)?v:"";return""};QueryString.stringify=QueryString.encode=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(isNull(obj)){obj=undefined}if(isObject(obj)){return map(keys(obj),function(k){var ks=QueryString.escape(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+QueryString.escape(stringifyPrimitive(v))}).join(sep)}else{return ks+QueryString.escape(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return QueryString.escape(stringifyPrimitive(name))+eq+QueryString.escape(stringifyPrimitive(obj))};QueryString.parse=QueryString.decode=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(!isString(qs)||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&isNumber(options.maxKeys)){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}try{k=decodeURIComponent(kstr);v=decodeURIComponent(vstr)}catch(e){k=QueryString.unescape(kstr,true);v=QueryString.unescape(vstr,true)}if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj}},{"../util":4}],2:[function(require,module,exports){var punycode={encode:function(s){return s}};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}var isObject=require("../util").isObject;var isString=require("../util").isString;var keys=require("../util").keys;var substr=require("../util").substr;exports.parse=urlParse;exports.format=urlFormat;exports.Url=Url;function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,delims=["<",">",'"',"`"," ","\r","\n","	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:true,"javascript:":true},hostlessProtocol={javascript:true,"javascript:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!isString(url)){throw new TypeError("Parameter 'url' must be a string, not "+typeof url)}var rest=url;rest=rest.trim();var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}var slashes;if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf("@")}else{atSign=rest.lastIndexOf("@",hostEnd)}if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}if(hostEnd===-1)hostEnd=rest.length;this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest="/"+notHost.join(".")+rest}this.hostname=validParts.join(".");break}}}}if(this.hostname.length>hostnameMaxLen){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!ipv6Hostname){var domainArray=this.hostname.split(".");var newOut=[];for(var i=0;i<domainArray.length;++i){var s=domainArray[i];newOut.push(s.match(/[^A-Za-z0-9_-]/)?"xn--"+punycode.encode(s):s)}this.hostname=newOut.join(".")}var p=this.port?":"+this.port:"";var h=this.hostname||"";this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=="/"){rest="/"+rest}}}if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query)}rest=rest.slice(0,qm)}else if(parseQueryString){this.search="";this.query={}}if(rest)this.pathname=rest;if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var p=this.pathname||"";var s=this.search||"";this.path=p+s}this.href=this.format();return this};function urlFormat(obj){if(isString(obj))obj=urlParse(obj);if(!(obj instanceof Url))return Url.prototype.format.call(obj);return obj.format()}Url.prototype.format=function(){var auth=this.auth||"";if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,":");auth+="@"}var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=false,query="";if(this.host){host=auth+this.host}else if(this.hostname){host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){host+=":"+this.port}}if(this.query&&isObject(this.query)&&keys(this.query).length){query=querystring.stringify(this.query)}var search=this.search||query&&"?"+query||"";if(protocol&&substr(protocol,-1)!==":")protocol+=":";if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host="//"+(host||"");if(pathname&&pathname.charAt(0)!=="/")pathname="/"+pathname}else if(!host){host=""}if(hash&&hash.charAt(0)!=="#")hash="#"+hash;if(search&&search.charAt(0)!=="?")search="?"+search;pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)});search=search.replace("#","%23");return protocol+host+pathname+search+hash};Url.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){this.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host)this.hostname=host}},{"../util":4,querystring:1}],3:[function(require,module,exports){var urlParse=require("url").parse;var querystring=require("querystring");var isBrowser=typeof window!=="undefined";var getDefaults=function(){var defaultUrl="http://localhost:80";if(isBrowser){defaultUrl=window.location.href.toString()}var defaults=urlParse(defaultUrl);return defaults};if(!Array.isArray){Array.isArray=function(arg){return Object.prototype.toString.call(arg)=="[object Array]"}}var objectEach=function(obj,cb){for(var k in obj){cb(obj[k],k)}};var argsArray=function(obj){if(!obj)return[];if(Array.isArray(obj))return slice.call(obj);var args=[];objectEach(obj,function(v,k){args[k]=v});return args};var arrLast=function(arr){return arr[arr.length-1]};var arrFlatten=function(input,output){if(!output)output=[];for(var i=0;i<input.length;i++){var value=input[i];if(Array.isArray(value)){arrFlatten(value,output)}else{output.push(value)}}return output};var UrlGrey=function(url){if(!url&&isBrowser){url=window.location.href.toString()}this.url=url;this._parsed=null};UrlGrey.prototype.parsed=function(){if(!this._parsed){this._parsed=urlParse(this.url);var defaults=getDefaults();var p=this._parsed;p.protocol=p.protocol||defaults.protocol;p.protocol=p.protocol.slice(0,-1);if(p.hash){p.hash=p.hash.substring(1)}p.username="";p.password="";if(p.protocol!=="file"){p.port=parseInt(p.port,10);if(p.auth){var auth=p.auth.split(":");p.username=auth[0];p.password=auth[1]}}if(isBrowser){p.hostname=p.hostname||defaults.hostname}}this._parsed={protocol:this._parsed.protocol,auth:this._parsed.auth,host:this._parsed.host,port:this._parsed.port,hostname:this._parsed.hostname,hash:this._parsed.hash,search:this._parsed.search,query:this._parsed.query,pathname:this._parsed.pathname,path:this._parsed.path,href:this._parsed.href,username:this._parsed.username,password:this._parsed.password};return this._parsed};UrlGrey.prototype.extendedPath=function(url){if(url){var p=urlParse(url);var obj=new UrlGrey(this.toString());if(p.hash){p.hash=p.hash.substring(1)}obj.parsed().hash=p.hash;obj.parsed().query=p.query;obj=obj.path(p.pathname);return obj}else{var href=this.path();href+=this.queryString()?"?"+this.queryString():"";href+=this.hash()?"#"+this.hash():"";return href}};UrlGrey.prototype.port=function(num){var hostname=this.parsed().hostname;if(num){if(this.protocol()==="file"){throw new Error("file urls don't have ports")}var obj=new UrlGrey(this.toString());obj.parsed().port=parseInt(num,10);return obj}var output=this._parsed.port;if(!output){switch(this.protocol()){case"http":return 80;case"https":return 443;default:return null}}return parseInt(output,10)};UrlGrey.prototype.query=function(mergeObject){var path;if(mergeObject===false){return this.queryString("")}var url=this.url;if(!mergeObject){var parsed=urlParse(url);if(!!parsed.search){var qstr=parsed.search.substring(1);var output=querystring.parse(qstr);return output}return{}}else{var oldQuery=querystring.parse(this.queryString());objectEach(mergeObject,function(v,k){if(v===null){delete oldQuery[k]}else{oldQuery[k]=v}});var newString=querystring.stringify(oldQuery);return this.queryString(newString)}};UrlGrey.prototype.rawQuery=function(mergeObject){var path;if(mergeObject===false){return this.queryString("")}var url=this.url;if(!mergeObject){var parsed=urlParse(url);if(!!parsed.search){var qstr=parsed.search.substring(1);return querystring.parse(qstr)}return{}}else{var oldQuery=querystring.parse(this.queryString());objectEach(mergeObject,function(v,k){if(v===null){delete oldQuery[k]}else{oldQuery[k]=v}});var pairs=[];objectEach(oldQuery,function(v,k){pairs.push(k+"="+v)});var newString=pairs.join("&");return this.queryString(newString)}};addPropertyGetterSetter("protocol");addPropertyGetterSetter("username");addPropertyGetterSetter("password");addPropertyGetterSetter("hostname");addPropertyGetterSetter("hash");addPropertyGetterSetter("query","queryString");addPropertyGetterSetter("pathname","path");UrlGrey.prototype.path=function(){var args=arrFlatten(argsArray(arguments));if(args.length!==0){var obj=new UrlGrey(this.toString());var str=args.join("/");str=str.replace(/\/+/g,"/");str=str.replace(/\/$/,"");args=str.split("/");for(var i=0;i<args.length;i++){args[i]=encodeURIComponent(args[i])}str=args.join("/");if(str[0]!=="/"){str="/"+str}obj.parsed().pathname=str;return obj}return this.parsed().pathname};UrlGrey.prototype.rawPath=function(){var args=arrFlatten(argsArray(arguments));if(args.length!==0){var obj=new UrlGrey(this.toString());var str=args.join("/");str=str.replace(/\/+/g,"/");str=str.replace(/\/$/,"");if(str[0]!=="/"){str="/"+str}obj.parsed().pathname=str;return obj}return this.parsed().pathname};UrlGrey.prototype.encode=function(str){return encodeURIComponent(str)};UrlGrey.prototype.decode=function(str){return decodeURIComponent(str)};UrlGrey.prototype.parent=function(){var pieces=this.path().split("/");var popped=pieces.pop();if(popped===""){popped=pieces.pop()}if(!popped){throw new Error("The current path has no parent path")}return this.query(false).hash("").path(pieces.join("/"))};UrlGrey.prototype.rawChild=function(suffixes){if(suffixes){suffixes=argsArray(arguments);return this.query(false).hash("").rawPath(this.path(),suffixes)}else{var pieces=this.path().split("/");var last=arrLast(pieces);if(pieces.length>1&&last===""){pieces.pop();last=arrLast(pieces)}return last}};UrlGrey.prototype.child=function(suffixes){suffixes=argsArray(arguments);if(suffixes.length>0){return this.query(false).hash("").path(this.path(),suffixes)}else{var pieces=this.path().split("/");var last=arrLast(pieces);if(pieces.length>1&&last===""){pieces.pop();last=arrLast(pieces)}return last}};UrlGrey.prototype.toJSON=function(){return this.toString()};UrlGrey.prototype.toString=function(){var p=this.parsed();var retval=this.protocol()+"://";if(this.protocol()!=="file"){var userinfo=p.username+":"+p.password;if(userinfo!=":"){retval+=userinfo+"@"}retval+=p.hostname;var port=portString(this);if(port!==""){retval+=":"+port}}retval+=this.path()==="/"?"":this.path();var qs=this.queryString();if(qs){retval+="?"+qs}if(p.hash){retval+="#"+p.hash}return retval};var portString=function(o){if(o.protocol()==="https"){if(o.port()===443){return""}}if(o.protocol()==="http"){if(o.port()===80){return""}}return""+o.port()};module.exports=function(url){return new UrlGrey(url)};function addPropertyGetterSetter(propertyName,methodName){if(!methodName){methodName=propertyName}UrlGrey.prototype[methodName]=function(str){if(!!str||str===""){var obj=new UrlGrey(this.toString());obj.parsed()[propertyName]=str;return obj}return this.parsed()[propertyName]}}},{querystring:1,url:2}],4:[function(require,module,exports){var isObject=function(o){return typeof o=="object"&&o!==null&&Object.prototype.toString.call(o)==="[object Object]"};exports.isObject=isObject;exports.isString=function(o){return Object.prototype.toString.call(o)=="[object String]"};exports.isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"};exports.isBoolean=function(o){return typeof o==="boolean"};exports.isNumber=function(o){return typeof o==="number"&&isFinite(o)};exports.isNull=function(o){return o===null};exports.keys=function(object){if(!isObject(object)){throw new TypeError("Object.keys called on a non-object")}var result=[];for(var name in object){if(hasOwnProperty.call(object,name)){result.push(name)}}return result};if("ab".substr(-1)!=="b"){exports.substr=function(str,start,length){if(start<0)start=str.length+start;return str.substr(start,length)}}else{exports.substr=function(str,start,length){return str.substr(start,length)}}exports.map=function map(xs,fn){if(xs.map)return xs.map(fn);var out=new Array(xs.length);for(var i=0;i<xs.length;i++){out[i]=fn(xs[i],i,xs)}return out}},{}]},{},[3])(3)});